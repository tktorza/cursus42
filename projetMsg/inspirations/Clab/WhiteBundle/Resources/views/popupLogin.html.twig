<div class="modal fade" tabindex="-1" role="dialog" id="login-modal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <a href="{{ path('clab_white_homepage') }}">
                    <svg viewBox="0 0 125.12 27.71" class="svg-logo-header">
                        <path class="cls-2" d="M14.59,11.07c1.38-2,3.45-2.9,6.24-2.9,3.59,0,7.51,2.46,7.51,7.92V27.18h-4V16.67a3.91,3.91,0,0,0-3.55-4.24h-.45a4.22,4.22,0,0,0-4.25,3.08V27.18h-4V16.67a3.92,3.92,0,0,0-3.57-4.24H8.09A4.21,4.21,0,0,0,4,15.5V27.18H0V8.65H3.81v2c.54-1.39,2.39-2.46,5-2.46A6.94,6.94,0,0,1,14.59,11.07Z"/>
                        <path class="cls-2" d="M33.29,11.47a8.52,8.52,0,0,1,7-3.3c4.83,0,8,2.64,8,7.29V27.18H44.51V25.57c-.91,1.28-3.19,2.09-5.19,2.09-4.06,0-7-2.31-7-6.08s3.34-6,7.29-6a7.33,7.33,0,0,1,4.72,1.36v-.76c0-2.75-2.14-3.81-4.57-3.81a6.81,6.81,0,0,0-5.48,2.42ZM44.36,20.6c-.47-.88-2.21-1.39-4-1.39-2.54,0-4,.84-4,2.27s1.45,2.27,4,2.27c1.78,0,3.52-.77,4-1.8Z"/>
                        <path class="cls-2" d="M64.9,25.47a5.18,5.18,0,0,1-4.39,2.24c-4,0-5.92-2.13-5.92-6.3v-8.5H51.36V11.63l6-7.66h1.2V8.66h6.13v4.25H58.55v7.7c0,2.05,1,2.86,2.69,2.86a3.62,3.62,0,0,0,2.83-1.39Z"/>
                        <path class="cls-2" d="M72.43,18.84c-2.76-1.43-4.17-3.19-4.17-5.42,0-2.93,2.25-5.24,5.84-5.24a6.59,6.59,0,0,1,5.44,2.64l-.73,3.56a6.88,6.88,0,0,0-4.72-2c-1.05,0-1.85.33-1.85,1.17s.65,1.17,1.74,1.76l1.89,1c2.94,1.54,4.46,3,4.46,5.72,0,3.26-2.54,5.68-6.49,5.68a7,7,0,0,1-6.1-3.26L68.79,21a6.52,6.52,0,0,0,5.26,2.57c1.23,0,2.36-.44,2.36-1.58,0-.92-.83-1.54-2.25-2.27Z"/>
                        <path class="cls-2" d="M84.17,19.28V8.65h4V18.84c0,3,1.85,4.62,4.25,4.62,2.14,0,4.14-1.32,4.5-3.15V8.65h4V27.18H97v-2c-.51,1.39-2.29,2.46-5,2.46C88.19,27.71,84.17,25.18,84.17,19.28Z"/>
                        <path class="cls-2" d="M116.57,13.26a4.17,4.17,0,0,0-2.5-.84,4,4,0,0,0-4,3.33V27.18h-4V8.65H110v2.46a4.07,4.07,0,0,1,4.17-2.93,3.51,3.51,0,0,1,3,1.47Z"/>
                        <path class="cls-2" d="M122.26,0a2.79,2.79,0,1,1-2.72,2.86V2.79A2.77,2.77,0,0,1,122.26,0Zm-2,8.65h4V27.18h-4Z"/>
                    </svg>
                </a>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            </div>
            <div class="modal-body">
                <div id="error" style="color:red;"></div>
                <p class="text-error" id="errorSubscription" style="color:red;"></p>
                <div class="row">
                    {{ render(controller('ClabWhiteBundle:User:login', {'isModal': true})) }}
                    {{ render(controller('ClabWhiteBundle:User:register')) }}
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://code.jquery.com/jquery-2.2.3.min.js" integrity="sha256-a23g1Nt4dtEYOj7bR+vTu7+T8VP13humZFBJNIYoEJo="   crossorigin="anonymous"></script>

<script defer>
    $(function() {
        $('#clab_white_register_birthday').datepicker();
        $('#buttonLogin').click(function(e){
            e.preventDefault();
            $.ajax({
                type        : "POST",
                url         : '{{ path("fos_user_security_check") }}',
                data        : $('#formLogin').serialize(),
                dataType    : "json",
                success     : function(data, status, object) {
                    console.log(data)
                    if(data.success == false)
                    {
                        if(data.message == "Bad credentials.")
                        {
                            $('#error').html('Mauvais email ou mot de passe');
                        }
                    }
                    else
                    {
                        $('#login-modal').modal('toggle');
                        $('#login-div').remove();
                        $('#review-button').off();
                        $('#ask-command').off();
                        var coversUrl = window.location.protocol + "//" + window.location.host + "/" + data.cover;

                        location.reload();
                        return Promise.resolve($.ajax({
                            status: "ok"
                        }));
                    }
                    if(data.error) $('.error').html(data.message);
                },
                error: function(data, status, object){
                }
            });
        });
        $('#logout-button').click(function(e){
            e.preventDefault();
            $.ajax({
                type        : "POST",
                url         : '{{ path("fos_user_security_logout") }}',
                data        : $('#formLogin').serialize(),
                dataType    : "json",
                success     : function(data, status, object) {

                    $('#account-div').remove();
                    $("#top-nav").append(' <li id="login-div"><a href="#myModal" data-toggle="modal" data-target="#myModal">INSCRIPTION/CONNEXION</a></li>');
                    $('#review-button').on('click',function(e) {
                        e.stopPropagation();
                        e.preventDefault();
                        $('#myModal').modal('toggle');
                        $( document ).ajaxSuccess(function( event, xhr, settings ) {
                            $('#modalReview').modal('toggle');

                        });
                    });
                    $('#ask-command').on('click',function(e) {
                        e.stopPropagation();
                        e.preventDefault();
                        $('#myModal').modal('toggle');
                        $( document ).ajaxSuccess(function( event, xhr, settings ) {
                            $('#ask-command-ok')[0].click();
                        });
                    });
                },
                error: function(data, status, object){
                }
            });
        });
        $('#buttonRegister').click(function(e){
            e.preventDefault();
            $.ajax({
                type        : "POST",
                url         : '{{ path("clab_white_user_register") }}',
                data        : $('#registerForm').serialize(),
                dataType    : "json",
                success     : function(data, status, object) {
                    console.log(data)
                    if(data.success == false)
                    {
                        $('#errorSubscription').html(data.message);
                    }
                    else
                    {
                        $('#login-modal').modal('toggle');
                        $('#login-div').remove();
                        var coversUrl = window.location.protocol + "//" + window.location.host + "/" + data.cover;

                        location.reload();
                    }
                    if(data.error) $('.error').html(data.message);
                },
                error: function(data, status, object){
                }
            });
        });

    });
</script>
