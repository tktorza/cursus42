{% extends 'ClabMultisiteBundle:Mail:base.html.twig' %}

{% block title %}
Votre commande chez {{ restaurant.name }} a bien été prise en compte
{% endblock %}

{% block body %}
<p>
La commande sera livrée à votre adresse : {{ order.delivery.address.verbose }}<br>
Aujourd'hui entre {{ order.delivery.start|date('H:i') }} et {{ order.delivery.end|date('H:i') }}.<br>
Afin de valider la livraison, donnez le code suivant à votre livreur : <strong>{{ order.delivery.codeCustomer }}</strong>
<br><br>
Le montant de votre commande est de {{ order.price }} €.
{% if order.onlinePayment %}
  La commande a déjà été payée en ligne.<br>
{% else %}
  Vous avez choisi de payer à la livraison.<br>
{% endif %}
<br>
Récapitulatif de votre commande :<br>
<br>
<table>
  <tbody>
    {% set total = 0 %}

    {% for element in order.cart.elements %}
      <tr>
        {% if element.product != null %}

        <td>
          {{ element.product.name }} (x{{ element.quantity }})
        </td>
        <td>{{ (element.price*element.quantity)|number_format(2) }}€</td>
      </tr>
      {% set total = total + (element.price*element.quantity) %}

      {% elseif element.meal != null %}

        <td>{{ element.meal.name }} (x{{ element.quantity }})</td>

        <td>{{ (element.price*element.quantity)|number_format(2) }}€</td>
      </tr>
      {% for children in element.childrens %}
        <tr>
          <td> - {{ children.product.name }} (x{{ children.quantity * element.quantity }})</td>
          <td>{{ (children.price * children.quantity * element.quantity)|number_format(2) }}€</td>
        </tr>
      {% endfor %}

      {% endif %}

    {% endfor %}
    {% if order.cart.deliveryCart is not null and order.cart.deliveryCart.extra and order.cart.deliveryCart.extra > 0 %}
      <tr>
        <td>Supplément livraison</td>
        <td><span class="pull-rigth">{{ order.cart.deliveryCart.extra }}€</span></td>
      </tr>
    {% endif %}
    {% if order.cart.discount is not null %}
        <tr>
          <td colspan="2">Offre : {{ order.cart.discount.name }}</td>
        </tr>
    {% endif %}
    {% if order.cart.discount is not null %}
        <tr>
          <td colspan="2">Offre : {{ order.cart.discount.name }}</td>
        </tr>
    {% endif %}
    <tr>
      <td><strong>Total</strong></td>
      <td><strong>{{ order.cart.totalPrice|number_format(2) }}€</strong></td>
    </tr>
  </tbody>
</table>
<br>
En cas de problème avec votre commande, elle reste accessible sur votre profil.<br>
<br>
Il ne vous reste plus qu’à savourer !<br>
<br>
L’équipe {{ restaurant.name }} et Clickeat.
</p>
{% endblock %}